#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

commit_msg=$(cat "$1")

# Clean Commit convention pattern
# Format: <emoji> <type>[(<scope>)]: <description>
# Emojis: ğŸ“¦ new | ğŸ”§ update | ğŸ—‘ï¸ remove | ğŸ”’ security | âš™ï¸ setup | â˜• chore | ğŸ§ª test | ğŸ“– docs | ğŸš€ release
pattern='^(ğŸ“¦|ğŸ”§|ğŸ—‘ï¸|ğŸ”’|âš™ï¸|â˜•|ğŸ§ª|ğŸ“–|ğŸš€) (new|update|remove|security|setup|chore|test|docs|release)(\([a-z0-9][a-z0-9-]*\))?: .{1,72}$'

# Allow merge commits
if echo "$commit_msg" | grep -qE "^Merge "; then
  exit 0
fi

# Validate against Clean Commit pattern (first line only)
first_line=$(echo "$commit_msg" | head -n 1)
if ! echo "$first_line" | grep -qP "$pattern"; then
  echo ""
  echo "âœ– Invalid commit message format."
  echo ""
  echo "  Expected: <emoji> <type>[(<scope>)]: <description>"
  echo ""
  echo "  Types and emojis:"
  echo "    ğŸ“¦ new      â€“ new features, files, or capabilities"
  echo "    ğŸ”§ update   â€“ changes, refactoring, improvements"
  echo "    ğŸ—‘ï¸  remove   â€“ removing code, files, or dependencies"
  echo "    ğŸ”’ security â€“ security fixes or patches"
  echo "    âš™ï¸  setup    â€“ configs, CI/CD, tooling, build systems"
  echo "    â˜• chore    â€“ maintenance, dependency updates"
  echo "    ğŸ§ª test     â€“ adding or updating tests"
  echo "    ğŸ“– docs     â€“ documentation changes"
  echo "    ğŸš€ release  â€“ version releases"
  echo ""
  echo "  Examples:"
  echo "    ğŸ“¦ new: user authentication system"
  echo "    ğŸ”§ update (api): improve error handling"
  echo "    âš™ï¸  setup (ci): configure github actions workflow"
  echo ""
  echo "  Reference: https://github.com/wgtechlabs/clean-commit"
  echo ""
  exit 1
fi
